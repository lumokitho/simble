{
  "version": 3,
  "file": "simble.js",
  "sourceRoot": "",
  "sources": [
    "simble.coffee"
  ],
  "names": [],
  "mappings": "AAAA;AAAA,IAAA,cAAA,EAAA,YAAA,EAAA,UAAA,EAAA,OAAA,EAAA,cAAA,EAAA,yBAAA,EAAA,0BAAA,EAAA,oBAAA,EAAA,2BAAA,EAAA,uBAAA,EAAA,wBAAA,EAAA,iBAAA,EAAA,aAAA,EAAA,iBAAA,EAAA,kBAAA,EAAA,iBAAA,EAAA,cAAA,EAAA,WAAA,EAAA,KAAA,EAAA,mBAAA,EAAA,iBAAA,EAAA,aAAA,EAAA,kBAAA;EAAA;;AAEA,KAAA,GAAQ,OAAA,CAAQ,OAAR;;AACR,YAAA,GAAe,OAAA,CAAQ,QAAR,EAHf;;;AAMA,cAAA,GAAiB,QAAA,CAAC,KAAD,CAAA;SACf,CAAC,KAAA,KAAW,MAAZ,CAAA,IAA2B,CAAC,KAAA,KAAW,IAAZ;AADZ;;AAGjB,iBAAA,GAAoB,QAAA,CAAA,GAAC,MAAD,CAAA;AACnB,MAAA,CAAA,EAAA,GAAA,EAAA;EAAA,KAAA,wCAAA;;IACC,IAAG,cAAA,CAAe,KAAf,CAAH;AACC,aAAO,MADR;;EADD;AADmB;;AAMpB,oBAAA,GAAuB,QAAA,CAAC,MAAD,CAAA;SACtB,CAAC,GAAA,MAAD;AADsB;;AAGvB,uBAAA,GAA0B,QAAA,CAAC,UAAD,CAAA;SACzB,UAAU,CAAC,OAAX,CAAmB,eAAnB,EAAoC,EAApC,CAAuC,CAAC,WAAxC,CAAA;AADyB;;AAG1B,iBAAA,GAAoB,QAAA,CAAC,IAAD,CAAA;AACnB,MAAA;EAAA,GAAA,GAAM,uBAAA,CAAwB,IAAxB;SACN,CAAA,CAAA,CAAG,GAAI,YAAP,CAAc,CAAd,CAAA,CAAiB,GAAI,aAArB,CAA6B,CAA7B,CAAA,CAAgC,GAAI,cAApC,CAA6C,CAA7C,CAAA,CAAgD,GAAI,cAApD,CAA6D,CAA7D,CAAA,CAAgE,GAAI,cAApE,CAAA;AAFmB;;AAIpB,2BAAA,GAA8B,QAAA,CAAC,IAAD,CAAA;EAC7B,IAAI,OAAO,IAAP,KAAgB,QAApB;IACC,IAAA,GAAO,IAAI,CAAC,QAAL,CAAc,IAAd,EADR;;EAEA,IAAA,GAAO,uBAAA,CAAwB,IAAxB;EACP,IAAI,IAAI,CAAC,MAAL,GAAc,CAAlB;IACC,IAAA,GAAO,CAAC,UAAA,GAAa,IAAd,CAAmB,CAAC,KAApB,CAA0B,CAAC,CAA3B,EADR;;EAEA,IAAI,IAAI,CAAC,MAAL,KAAe,CAAnB;IACC,IAAA,IAAQ,uBADT;;SAEA,iBAAA,CAAkB,IAAlB;AAR6B;;AAU9B,iBAAA,GAAoB,QAAA,CAAC,KAAD,EAAQ,UAAR,CAAA;AACnB,MAAA,CAAA,EAAA,KAAA,EAAA,GAAA,EAAA,IAAA,EAAA;AAA0C;EAAA,KAAa,qHAAb;iBAAzC,KAAK,CAAC,KAAN,CAAY,KAAZ,EAAoB,KAAA,GAAQ,UAA5B;EAAyC,CAAA;;AADvB;;AAGpB,wBAAA,GAA2B,QAAA,CAAC,WAAD,CAAA;SAC1B,iBAAA,CAAkB,uBAAA,CAAwB,WAAxB,CAAlB,EAAwD,CAAxD,CAA0D,CAAC,IAA3D,CAAgE,GAAhE;AAD0B;;AAGrB,iBAAN,MAAA,eAAA,QAA6B,aAA7B;EACC,WAAa,sBAAA,UAAA,CAAA;;IAAC,IAAC,CAAA;IAAsB,IAAC,CAAA;IAErC,IAAC,CAAA,IAAD,GAAQ,2BAAA,CAA4B,IAAC,CAAA,oBAAoB,CAAC,IAAlD;IACR,IAAC,CAAA,oBAAoB,CAAC,EAAtB,CAAyB,MAAzB,EAAiC,CAAC,IAAD,EAAO,eAAP,CAAA,GAAA;MAChC,IAAC,CAAA,IAAD,CAAM,MAAN,EAAc,IAAd,EAAoB,eAApB;IADgC,CAAjC;AAGA;EANY;;EAOb,IAAM,CAAA,CAAA;WACL,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;MACX,IAAC,CAAA,oBAAoB,CAAC,IAAtB,CAA2B,CAAC,KAAD,EAAQ,IAAR,CAAA,GAAA;QAC1B,IAAG,KAAH;UACC,MAAA,CAAO,KAAP,EADD;SAAA,MAAA;UAGC,OAAA,CAAQ,oBAAA,CAAqB,IAArB,CAAR,EAHD;;MAD0B,CAA3B;IADW,CAAZ;EADK;;EASN,KAAO,CAAC,IAAD,EAAO,gBAAP,CAAA;IACN,IAAG,CAAI,MAAM,CAAC,QAAP,CAAgB,IAAhB,CAAP;MACC,IAAA,GAAO,MAAM,CAAC,IAAP,CAAY,IAAZ,EADR;;WAEA,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;MACX,IAAC,CAAA,oBAAoB,CAAC,KAAtB,CAA4B,IAA5B,EAAkC,iBAAA,CAAkB,gBAAlB,EAAoC,KAApC,CAAlC,EAA8E,CAAC,KAAD,CAAA,GAAA;QAC7E,IAAG,KAAH;UACC,MAAA,CAAO,KAAP,EADD;SAAA,MAAA;UAGC,OAAA,CAAQ,IAAR,EAHD;;MAD6E,CAA9E;IADW,CAAZ;EAHM;;EAWP,SAAW,CAAC,QAAD,CAAA;WACV,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;MACX,IAAC,CAAA,oBAAoB,CAAC,SAAtB,CAAgC,CAAC,KAAD,CAAA,GAAA;QAC/B,IAAG,KAAH;UACC,MAAA,CAAO,KAAP,EADD;SAAA,MAAA;UAGC,IAAC,CAAA,WAAD,CAAa,MAAb,EAAqB,QAAA,CAAC,IAAD,CAAA;mBACpB,QAAA,CAAS,oBAAA,CAAqB,IAArB,CAAT;UADoB,CAArB;UAEA,OAAA,CAAQ,IAAR,EALD;;MAD+B,CAAhC;IADW,CAAZ;EADU;;AA5BZ;;AAwCM,UAAN,MAAA,QAAA,QAAsB,aAAtB;EACC,WAAa,eAAA,aAAA,CAAA;;IAAC,IAAC,CAAA;IAAe,IAAC,CAAA;IAE9B,IAAC,CAAA,IAAD,GAAQ,2BAAA,CAA4B,IAAC,CAAA,aAAa,CAAC,IAA3C;IACR,IAAC,CAAA,sBAAD,CAAA;AACA;EAJY;;EAKb,sBAAwB,CAAA,CAAA;AACvB,QAAA,CAAA,EAAA,GAAA,EAAA,oBAAA,EAAA;IAAA,IAAC,CAAA,eAAD,GAAmB,CAAA;IACnB,IAAG,IAAC,CAAA,aAAa,CAAC,eAAlB;AACC;MAAA,KAAA,qCAAA;;QACC,IAAC,CAAA,eAAgB,CAAA,2BAAA,CAA4B,oBAAoB,CAAC,IAAjD,CAAA,CAAjB,GAA2E,IAAI,cAAJ,CAAmB,oBAAnB,EAAyC,IAAzC;MAD5E,CADD;;EAFuB;;EAMxB,iBAAmB,CAAA,CAAA;WAClB,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;aACX,IAAC,CAAA,UAAU,CAAC,iBAAZ,CAAA,CACA,CAAC,IADD,CACM,CAAA,CAAA,GAAA;QACL,OAAA,CAAQ,IAAR;MADK,CADN;IADW,CAAZ;EADkB;;EAMnB,6BAA+B,CAAC,iBAAD,CAAA;WAC9B,IAAC,CAAA,eAAgB,CAAA,2BAAA,CAA4B,iBAA5B,CAAA;EADa;;EAE/B,kBAAoB,CAAC,iBAAD,CAAA;WACnB,IAAC,CAAA,iBAAD,CAAA,CACA,CAAC,IADD,CACM,CAAA,CAAA,GAAA;aACL,IAAC,CAAA,6BAAD,CAA+B,iBAA/B;IADK,CADN;EADmB;;AApBrB;;AAyBM,aAAN,MAAA,WAAA,QAAyB,aAAzB;EACC,WAAa,kBAAA,CAAA;;IAAC,IAAC,CAAA;IAEd,IAAC,CAAA,OAAD,GAAW,wBAAA,CAAyB,IAAC,CAAA,gBAAgB,CAAC,OAA3C;IACX,IAAC,CAAA,YAAD,GAAgB,IAAC,CAAA,gBAAgB,CAAC;IAClC,IAAC,CAAA,eAAD,CAAA;IACA,IAAC,CAAA,WAAD,GAAe,IAAC,CAAA,gBAAgB,CAAC;IACjC,IAAC,CAAA,IAAD,GAAQ,IAAC,CAAA,gBAAgB,CAAC;IAC1B,IAAC,CAAA,aAAD,GACC;MAAA,IAAA,EAAM,IAAC,CAAA,gBAAgB,CAAC,aAAa,CAAC,SAAtC;MACA,aAAA,EAAe,IAAC,CAAA,gBAAgB,CAAC,aAAa,CAAC,YAAY,CAAC,GAA7C,CAAiD,2BAAjD,CADf;MAEA,iBAAA,EAAmB,IAAC,CAAA,gBAAgB,CAAC,aAAa,CAAC;IAFnD;IAGD,IAAC,CAAA,aAAD,GAAiB;IACjB,IAAC,CAAA,YAAD,GAAgB;IAChB,IAAC,CAAA,gBAAgB,CAAC,EAAlB,CAAqB,SAArB,EAAgC,CAAA,CAAA,GAAA;MAC/B,IAAC,CAAA,YAAD,GAAgB;MAChB,IAAC,CAAA,IAAD,CAAM,WAAN;IAF+B,CAAhC;IAIA,IAAC,CAAA,gBAAgB,CAAC,EAAlB,CAAqB,YAArB,EAAmC,CAAA,CAAA,GAAA;MAClC,IAAC,CAAA,YAAD,GAAgB;MAChB,IAAC,CAAA,aAAD,GAAiB;MACjB,IAAC,CAAA,IAAD,CAAM,cAAN;IAHkC,CAAnC;IAKA,IAAC,CAAA,gBAAgB,CAAC,EAAlB,CAAqB,YAArB,EAAmC,CAAC,IAAD,CAAA,GAAA;MAClC,IAAC,CAAA,IAAD,GAAQ;MACR,IAAC,CAAA,IAAD,CAAM,aAAN,EAAqB,IAArB;IAFkC,CAAnC;AAIA;EA1BY;;EA2Bb,eAAiB,CAAA,CAAA;AAChB,QAAA,CAAA,EAAA,GAAA,EAAA,aAAA,EAAA;IAAA,IAAC,CAAA,QAAD,GAAY,CAAA;IACZ,IAAG,IAAC,CAAA,gBAAgB,CAAC,QAArB;AACC;MAAA,KAAA,qCAAA;;QACC,IAAC,CAAA,QAAS,CAAA,2BAAA,CAA4B,aAAa,CAAC,IAA1C,CAAA,CAAV,GAA6D,IAAI,OAAJ,CAAY,aAAZ,EAA2B,IAA3B;MAD9D,CADD;;EAFgB;;EAMjB,UAAY,CAAA,CAAA;WACX,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;MACX,IAAC,CAAA,gBAAgB,CAAC,UAAlB,CAA6B,CAAC,KAAD,CAAA,GAAA;QAC5B,IAAG,KAAH;UACC,MAAA,CAAO,KAAP,EADD;SAAA,MAAA;UAGC,OAAA,CAAQ,IAAR,EAHD;;MAD4B,CAA7B;IADW,CAAZ;EADW;;EASZ,gBAAkB,CAAA,CAAA;WACjB,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;MACX,IAAG,IAAC,CAAA,YAAJ;QACC,OAAA,CAAQ,IAAR,EADD;OAAA,MAAA;QAGC,IAAC,CAAA,gBAAgB,CAAC,OAAlB,CAA0B,CAAC,KAAD,CAAA,GAAA;UACzB,IAAG,KAAH;YACC,MAAA,CAAO,KAAP,EADD;WAAA,MAAA;YAGC,OAAA,CAAQ,IAAR,EAHD;;QADyB,CAA1B,EAHD;;IADW,CAAZ;EADiB;;EAYlB,OAAS,CAAA,CAAA;WACR,IAAC,CAAA,gBAAD,CAAA;EADQ;;EAET,iBAAmB,CAAA,CAAA;WAClB,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,CAAA,GAAA;MACX,IAAG,IAAC,CAAA,aAAJ;QACC,OAAA,CAAQ,IAAR,EADD;OAAA,MAAA;QAGC,IAAC,CAAA,gBAAgB,CAAC,qCAAlB,CAAwD,CAAC,KAAD,CAAA,GAAA;UACvD,IAAG,KAAH;YACC,MAAA,CAAO,KAAP,EADD;WAAA,MAAA;YAGC,IAAC,CAAA,eAAD,CAAA;YACA,IAAC,CAAA,aAAD,GAAiB;YACjB,IAAC,CAAA,IAAD,CAAM,YAAN;YACA,OAAA,CAAQ,IAAR,EAND;;QADuD,CAAxD,EAHD;;IADW,CAAZ;EADkB;;EAenB,QAAU,CAAA,CAAA;WACT,IAAC,CAAA,iBAAD,CAAA;EADS;;EAEV,+BAAiC,CAAA,CAAA;WAChC,IAAC,CAAA,gBAAD,CAAA,CACA,CAAC,IADD,CACM,CAAA,CAAA,GAAA;aACL,IAAC,CAAA,iBAAD,CAAA;IADK,CADN;EADgC;;EAIjC,sBAAwB,CAAC,UAAD,CAAA;WACvB,IAAC,CAAA,QAAS,CAAA,2BAAA,CAA4B,UAA5B,CAAA;EADa;;EAExB,WAAa,CAAC,UAAD,CAAA;WACZ,IAAC,CAAA,iBAAD,CAAA,CACA,CAAC,IADD,CACM,CAAA,CAAA,GAAA;aACL,IAAC,CAAA,sBAAD,CAAwB,UAAxB;IADK,CADN;EADY;;EAIb,kBAAoB,CAAC,UAAD,EAAa,iBAAb,CAAA;WACnB,IAAC,CAAA,WAAD,CAAa,UAAb,CACA,CAAC,IADD,CACM,QAAA,CAAC,OAAD,CAAA;aACL,OAAO,CAAC,kBAAR,CAA2B,iBAA3B;IADK,CADN;EADmB;;AApFrB;;AAyFA,cAAA,GAAiB,QAAA,CAAC,OAAD,CAAA;EAChB,OAAA,GAAU,wBAAA,CAAyB,OAAzB;SACV,QAAA,CAAC,UAAD,CAAA;WACE,UAAU,CAAC,OAAX,KAAsB;EADxB;AAFgB;;AAKjB,WAAA,GAAc,QAAA,CAAC,IAAD,CAAA;SACb,QAAA,CAAC,UAAD,CAAA;WACE,UAAU,CAAC,aAAa,CAAC,IAAzB,KAAiC;EADnC;AADa;;AAId,yBAAA,GAA4B,QAAA,CAAC,UAAD,CAAA;AAC3B,MAAA;EAAA,YAAA,GAAe,2BAAA,CAA4B,UAA5B;SACf,QAAA,CAAC,UAAD,CAAA;WACE,aAAgB,UAAU,CAAC,aAAa,CAAC,aAAzC,EAAA,YAAA;EADF;AAF2B;;AAK5B,0BAAA,GAA6B,QAAA,CAAC,WAAD,CAAA;AAC5B,MAAA;EAAA,aAAA,GAAgB,WAAW,CAAC,GAAZ,CAAgB,2BAAhB;SAChB,QAAA,CAAC,UAAD,CAAA;AACC,QAAA,CAAA,EAAA,GAAA,EAAA;IAAA,KAAA,+CAAA;;MACC,IAAI,CAAI,CAAC,aAAgB,UAAU,CAAC,aAAa,CAAC,aAAzC,EAAA,YAAA,MAAD,CAAR;AACC,eAAO,MADR;;IADD;WAGA;EAJD;AAF4B;;AAQ7B,iBAAA,GAAoB,QAAA,CAAC,GAAD,EAAM,KAAN,CAAA;EACnB,IAAI,KAAA,KAAS,IAAb;WACC,QAAA,CAAA,CAAA;aAAG;IAAH,EADD;GAAA,MAAA;WAGC;MACC,OAAA,EAAS,kBADV;MAEC,IAAA,EAAM,WAFP;MAGC,OAAA,EAAS,yBAHV;MAIC,QAAA,EAAU;IAJX,CAKE,CAAA,GAAA,CALF,CAKO,KALP,EAHD;;AADmB;;AAWpB,aAAA,GAAgB,QAAA,CAAC,OAAD,CAAA;AACf,MAAA,GAAA,EAAA,WAAA,EAAA;EAAA,WAAA;;AAA6C;IAAA,KAAA,cAAA;;mBAA9B,iBAAA,CAAkB,GAAlB,EAAuB,KAAvB;IAA8B,CAAA;;;SAC7C,QAAA,CAAC,UAAD,CAAA;AACC,QAAA,CAAA,EAAA,GAAA,EAAA;IAAA,KAAA,6CAAA;;MACC,IAAI,CAAI,UAAA,CAAW,UAAX,CAAR;AACC,eAAO,MADR;;IADD;WAGA;EAJD;AAFe;;AAQhB,kBAAA,GAAqB,QAAA,CAAC,kBAAD,CAAA;SACpB,IAAI,OAAJ,CAAY,QAAA,CAAC,OAAD,EAAU,MAAV,CAAA;IACX,IAAI,KAAK,CAAC,KAAN,KAAe,kBAAnB;MACC,OAAA,CAAA,EADD;KAAA,MAAA;MAGC,KAAK,CAAC,EAAN,CAAS,aAAT,EAAwB,QAAA,CAAC,KAAD,CAAA;QACvB,IAAI,KAAA,KAAS,kBAAb;iBACC,OAAA,CAAA,EADD;;MADuB,CAAxB,EAHD;;EADW,CAAZ;AADoB;;AAUrB,mBAAA,GAAsB,QAAA,CAAC,iBAAD,CAAA;EACrB,IAAI,OAAO,iBAAP,KAA+B,UAAnC;IACC,iBAAA,GAAoB,aAAA,CAAc,iBAAd,EADrB;;SAEA,kBAAA,CAAmB,WAAnB,CACA,CAAC,IADD,CACM,QAAA,CAAA,CAAA;WACL,IAAI,OAAJ,CAAY,QAAA,CAAC,OAAD,EAAU,MAAV,CAAA;MACX,KAAK,CAAC,EAAN,CAAS,UAAT,EAAqB,QAAA,CAAC,gBAAD,CAAA;AACpB,YAAA;QAAA,UAAA,GAAa,IAAI,UAAJ,CAAe,gBAAf;QACb,IAAG,iBAAA,CAAkB,UAAlB,CAAH;UACC,OAAA,CAAQ,UAAR;UACA,KAAK,CAAC,YAAN,CAAA,EAFD;;MAFoB,CAArB;MAMA,KAAK,CAAC,aAAN,CAAA;IAPW,CAAZ;EADK,CADN;AAHqB;;AAetB,kBAAA,GAAqB,QAAA,CAAC,OAAD,EAAU,UAAV,CAAA;SACpB,IAAI,OAAJ,CAAY,QAAA,CAAC,OAAD,EAAU,MAAV,CAAA;IACX,OAAO,CAAC,OAAR,CAAgB,OAAhB,CACA,CAAC,IADD,CACM,QAAA,CAAC,cAAD,CAAA;aACL,OAAA,CAAQ,cAAR;IADK,CADN,CAGA,CAAC,KAHD,CAGO,QAAA,CAAC,aAAD,CAAA;aACN,MAAA,CAAO,aAAP;IADM,CAHP;IAKA,UAAA,CAAW,QAAA,CAAA,CAAA;aACT,MAAA,CAAO,qCAAP;IADS,CAAX,EAEG,UAFH;EANW,CAAZ;AADoB;;AAYrB,aAAA,GAAgB,QAAA,CAAA,CAAA;SACf,IAAI,OAAJ,CAAY,QAAA,CAAC,OAAD,EAAU,MAAV,CAAA;IACX,KAAK,CAAC,IAAN,CAAW,UAAX,EAAuB,QAAA,CAAA,CAAA;MACtB,OAAA,CAAA;IADsB,CAAvB;IAGA,KAAK,CAAC,YAAN,CAAA;EAJW,CAAZ;AADe;;AAQhB,MAAM,CAAC,OAAP,GACC;EAAA,YAAA,EACC;IAAA,cAAA,EAAgB,2BAAhB;IACA,OAAA,EAAS;EADT,CADD;EAGA,MAAA,EACC;IAAA,OAAA,EAAS,cAAT;IACA,IAAA,EAAM,WADN;IAEA,OAAA,EAAS,yBAFT;IAGA,QAAA,EAAU;EAHV,CAJD;EAQA,mBAAA,EAAqB,mBARrB;EASA,aAAA,EAAe;AATf",
  "sourcesContent": [
    "'use strict'\n\nnoble = require('noble')\nEventEmitter = require('events')\n\n# Returns true if the passed argument <value> is neither null nor undefined\nis_valid_value = (value) ->\n\t((value isnt undefined) and (value isnt null))\n\nfirst_valid_value = (values...) ->\n\tfor value in values\n\t\tif is_valid_value(value)\n\t\t\treturn value\n\treturn\n\nbuffer_to_byte_array = (buffer) ->\n\t[buffer...]\n\ncanonicalize_hex_string = (hex_string) ->\n\thex_string.replace(/[^0-9A-Fa-f]/g, '').toLowerCase()\n\ncanonicalize_uuid = (uuid) ->\n\thex = canonicalize_hex_string(uuid)\n\t\"#{hex[0...8]}-#{hex[8...12]}-#{hex[12...16]}-#{hex[16...20]}-#{hex[20...32]}\"\n\ncanonicalize_bluetooth_uuid = (uuid) ->\n\tif (typeof(uuid) is 'number')\n\t\tuuid = uuid.toString(0x10)\n\tuuid = canonicalize_hex_string(uuid)\n\tif (uuid.length < 8)\n\t\tuuid = ('00000000' + uuid).slice(-8)\n\tif (uuid.length is 8)\n\t\tuuid += '1000800000805f9b34fb'\n\tcanonicalize_uuid(uuid)\n\nsplit_into_chunks = (array, chunk_size) ->\n\t(array.slice(index, (index + chunk_size)) for index in [0...array.length] by chunk_size)\n\ncanonicalize_mac_address = (mac_address) ->\n\tsplit_into_chunks(canonicalize_hex_string(mac_address), 2).join(':')\n\nclass Characteristic extends EventEmitter\n\tconstructor: (@noble_characteristic, @service) ->\n\t\tsuper()\n\t\t@uuid = canonicalize_bluetooth_uuid(@noble_characteristic.uuid)\n\t\t@noble_characteristic.on 'data', (data, is_notification) =>\n\t\t\t@emit('data', data, is_notification)\n\t\t\treturn\n\t\treturn\n\tread: ->\n\t\tnew Promise (resolve, reject) =>\n\t\t\t@noble_characteristic.read (error, data) =>\n\t\t\t\tif error\n\t\t\t\t\treject(error)\n\t\t\t\telse\n\t\t\t\t\tresolve(buffer_to_byte_array(data))\n\t\t\t\treturn\n\t\t\treturn\n\twrite: (data, without_response) ->\n\t\tif not Buffer.isBuffer(data)\n\t\t\tdata = Buffer.from(data)\n\t\tnew Promise (resolve, reject) =>\n\t\t\t@noble_characteristic.write data, first_valid_value(without_response, false), (error) =>\n\t\t\t\tif error\n\t\t\t\t\treject(error)\n\t\t\t\telse\n\t\t\t\t\tresolve(@)\n\t\t\t\treturn\n\t\t\treturn\n\tsubscribe: (listener) ->\n\t\tnew Promise (resolve, reject) =>\n\t\t\t@noble_characteristic.subscribe (error) =>\n\t\t\t\tif error\n\t\t\t\t\treject(error)\n\t\t\t\telse\n\t\t\t\t\t@addListener 'data', (data) ->\n\t\t\t\t\t\tlistener(buffer_to_byte_array(data))\n\t\t\t\t\tresolve(@)\n\t\t\t\treturn\n\t\t\treturn\n\nclass Service extends EventEmitter\n\tconstructor: (@noble_service, @peripheral) ->\n\t\tsuper()\n\t\t@uuid = canonicalize_bluetooth_uuid(@noble_service.uuid)\n\t\t@update_characteristics()\n\t\treturn\n\tupdate_characteristics: ->\n\t\t@characteristics = {}\n\t\tif @noble_service.characteristics\n\t\t\tfor noble_characteristic in @noble_service.characteristics\n\t\t\t\t@characteristics[canonicalize_bluetooth_uuid(noble_characteristic.uuid)] = new Characteristic(noble_characteristic, @)\n\t\treturn\n\tensure_discovered: ->\n\t\tnew Promise (resolve, reject) =>\n\t\t\t@peripheral.ensure_discovered()\n\t\t\t.then =>\n\t\t\t\tresolve(@)\n\t\t\t\treturn\n\tget_discovered_characteristic: (characteristic_id) ->\n\t\t@characteristics[canonicalize_bluetooth_uuid(characteristic_id)]\n\tget_characteristic: (characteristic_id) ->\n\t\t@ensure_discovered()\n\t\t.then =>\n\t\t\t@get_discovered_characteristic(characteristic_id)\n\nclass Peripheral extends EventEmitter\n\tconstructor: (@noble_peripheral) ->\n\t\tsuper()\n\t\t@address = canonicalize_mac_address(@noble_peripheral.address)\n\t\t@address_type = @noble_peripheral.addressType\n\t\t@update_services()\n\t\t@connectable = @noble_peripheral.connectable\n\t\t@rssi = @noble_peripheral.rssi\n\t\t@advertisement =\n\t\t\tname: @noble_peripheral.advertisement.localName\n\t\t\tservice_uuids: @noble_peripheral.advertisement.serviceUuids.map(canonicalize_bluetooth_uuid)\n\t\t\tmanufacturer_data: @noble_peripheral.advertisement.manufacturerData\n\t\t@is_discovered = false\n\t\t@is_connected = false\n\t\t@noble_peripheral.on 'connect', =>\n\t\t\t@is_connected = true\n\t\t\t@emit 'connected'\n\t\t\treturn\n\t\t@noble_peripheral.on 'disconnect', =>\n\t\t\t@is_connected = false\n\t\t\t@is_discovered = false\n\t\t\t@emit 'disconnected'\n\t\t\treturn\n\t\t@noble_peripheral.on 'rssiUpdate', (rssi) =>\n\t\t\t@rssi = rssi\n\t\t\t@emit 'rssi_update', rssi\n\t\t\treturn\n\t\treturn\n\tupdate_services: ->\n\t\t@services = {}\n\t\tif @noble_peripheral.services\n\t\t\tfor noble_service in @noble_peripheral.services\n\t\t\t\t@services[canonicalize_bluetooth_uuid(noble_service.uuid)] = new Service(noble_service, @)\n\t\treturn\n\tdisconnect: ->\n\t\tnew Promise (resolve, reject) =>\n\t\t\t@noble_peripheral.disconnect (error) =>\n\t\t\t\tif error\n\t\t\t\t\treject(error)\n\t\t\t\telse\n\t\t\t\t\tresolve(@)\n\t\t\t\treturn\n\t\t\treturn\n\tensure_connected: ->\n\t\tnew Promise (resolve, reject) =>\n\t\t\tif @is_connected\n\t\t\t\tresolve(@)\n\t\t\telse\n\t\t\t\t@noble_peripheral.connect (error) =>\n\t\t\t\t\tif error\n\t\t\t\t\t\treject(error)\n\t\t\t\t\telse\n\t\t\t\t\t\tresolve(@)\n\t\t\t\t\treturn\n\t\t\treturn\n\tconnect: ->\n\t\t@ensure_connected()\n\tensure_discovered: ->\n\t\tnew Promise (resolve, reject) =>\n\t\t\tif @is_discovered\n\t\t\t\tresolve(@)\n\t\t\telse\n\t\t\t\t@noble_peripheral.discoverAllServicesAndCharacteristics (error) =>\n\t\t\t\t\tif error\n\t\t\t\t\t\treject(error)\n\t\t\t\t\telse\n\t\t\t\t\t\t@update_services()\n\t\t\t\t\t\t@is_discovered = true\n\t\t\t\t\t\t@emit 'discovered'\n\t\t\t\t\t\tresolve(@)\n\t\t\t\t\treturn\n\t\t\treturn\n\tdiscover: ->\n\t\t@ensure_discovered()\n\tensure_connected_and_discovered: ->\n\t\t@ensure_connected()\n\t\t.then =>\n\t\t\t@ensure_discovered()\n\tget_discovered_service: (service_id) ->\n\t\t@services[canonicalize_bluetooth_uuid(service_id)]\n\tget_service: (service_id) ->\n\t\t@ensure_discovered()\n\t\t.then =>\n\t\t\t@get_discovered_service(service_id)\n\tget_characteristic: (service_id, characteristic_id) ->\n\t\t@get_service(service_id)\n\t\t.then (service) ->\n\t\t\tservice.get_characteristic(characteristic_id)\n\naddress_filter = (address) ->\n\taddress = canonicalize_mac_address(address)\n\t(peripheral) ->\n\t\t(peripheral.address is address)\n\nname_filter = (name) ->\n\t(peripheral) ->\n\t\t(peripheral.advertisement.name is name)\n\nadvertised_service_filter = (service_id) ->\n\tservice_uuid = canonicalize_bluetooth_uuid(service_id)\n\t(peripheral) ->\n\t\t(service_uuid in peripheral.advertisement.service_uuids)\n\nadvertised_services_filter = (service_ids) ->\n\tservice_uuids = service_ids.map(canonicalize_bluetooth_uuid)\n\t(peripheral) ->\n\t\tfor servcice_uuid in service_uuids\n\t\t\tif (not (service_uuid in peripheral.advertisement.service_uuids))\n\t\t\t\treturn false\n\t\ttrue\n\ncreate_sub_filter = (key, value) ->\n\tif (value is null)\n\t\t-> true\n\telse\n\t\t{\n\t\t\taddress: mac_address_filter\n\t\t\tname: name_filter\n\t\t\tservice: advertised_service_filter\n\t\t\tservices: advertised_services_filter\n\t\t}[key](value)\n\ncreate_filter = (options) ->\n\tsub_filters = (create_sub_filter(key, value) for key, value of options)\n\t(peripheral) ->\n\t\tfor sub_filter in sub_filters\n\t\t\tif (not sub_filter(peripheral))\n\t\t\t\treturn false\n\t\ttrue\n\nensure_noble_state = (noble_state_string) ->\n\tnew Promise (resolve, reject) ->\n\t\tif (noble.state is noble_state_string)\n\t\t\tresolve()\n\t\telse\n\t\t\tnoble.on 'stateChange', (state) ->\n\t\t\t\tif (state is noble_state_string)\n\t\t\t\t\tresolve()\n\t\treturn\n\nscan_for_peripheral = (peripheral_filter) ->\n\tif (typeof(peripheral_filter) isnt 'function')\n\t\tperipheral_filter = create_filter(peripheral_filter)\n\tensure_noble_state('poweredOn')\n\t.then ->\n\t\tnew Promise (resolve, reject) ->\n\t\t\tnoble.on 'discover', (noble_peripheral) ->\n\t\t\t\tperipheral = new Peripheral(noble_peripheral)\n\t\t\t\tif peripheral_filter(peripheral)\n\t\t\t\t\tresolve(peripheral)\n\t\t\t\t\tnoble.stopScanning()\n\t\t\t\treturn\n\t\t\tnoble.startScanning()\n\t\t\treturn\n\ntime_limit_promise = (promise, time_limit) ->\n\tnew Promise (resolve, reject) ->\n\t\tPromise.resolve(promise)\n\t\t.then (promise_result) ->\n\t\t\tresolve(promise_result)\n\t\t.catch (promise_error) ->\n\t\t\treject(promise_error)\n\t\tsetTimeout ->\n\t\t\t\treject('Promise did not resolve within time')\n\t\t\t, time_limit\n\t\treturn\n\nstop_scanning = ->\n\tnew Promise (resolve, reject) ->\n\t\tnoble.once 'scanStop', ->\n\t\t\tresolve()\n\t\t\treturn\n\t\tnoble.stopScanning()\n\t\treturn\n\nmodule.exports =\n\tcanonicalize:\n\t\tbluetooth_uuid: canonicalize_bluetooth_uuid\n\t\taddress: canonicalize_mac_address\n\tfilter:\n\t\taddress: address_filter\n\t\tname: name_filter\n\t\tservice: advertised_service_filter\n\t\tservices: advertised_services_filter\n\tscan_for_peripheral: scan_for_peripheral\n\tstop_scanning: stop_scanning\n"
  ]
}